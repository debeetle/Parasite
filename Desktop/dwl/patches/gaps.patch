From b70e7e26d74e4f46b48f0d3ed67c8e9465d86c4e Mon Sep 17 00:00:00 2001
From: peesock <kcormn@gmail.com>
Date: Mon, 24 Jun 2024 20:06:42 -0700
Subject: [PATCH] gaps!

Co-authored-by: sewn <sewn@disroot.org>
Co-authored-by: serenevoid <ajuph9224@gmail.com>
---
 dwl.c        | 34 ++++++++++++++++++++++++++--------
 1 files changed, 30 insertions(+), 8 deletions(-)

diff --git a/dwl.c b/dwl.c
index 00e9cc1..9a3bf1d 100644
--- a/dwl.c
+++ b/dwl.c
@@ -2626,7 +2630,7 @@ tagmon(const Arg *arg)
 void
 tile(Monitor *m)
 {
-	unsigned int mw, my, ty;
+	unsigned int h, r, mw, my, ty;
 	int i, n = 0;
 	Client *c;
 
@@ -2635,23 +2639,30 @@ tile(Monitor *m)
 			n++;
 	if (n == 0)
 		return;
 
 	if (n > m->nmaster)
-		mw = m->nmaster ? ROUND(m->w.width * m->mfact) : 0;
+		mw = m->nmaster ? ROUND((m->w.width + gappx) * m->mfact) : 0;
 	else
 		mw = m->w.width;
-	i = my = ty = 0;
+	i = 0;
+	my = ty = gappx;
 	wl_list_for_each(c, &clients, link) {
 		if (!VISIBLEON(c, m) || c->isfloating || c->isfullscreen)
 			continue;
 		if (i < m->nmaster) {
-			resize(c, (struct wlr_box){.x = m->w.x, .y = m->w.y + my, .width = mw,
-				.height = (m->w.height - my) / (MIN(n, m->nmaster) - i)}, 0);
-			my += c->geom.height;
+			r = MIN(n, m->nmaster) - i;
+			h = (m->w.height - my - gappx - gappx * (r - 1)) / r;
+			resize(c, (struct wlr_box){.x = m->w.x + gappx, .y = m->w.y + my,
+				.width = mw - 2*gappx, .height = h}, 0);
+			my += c->geom.height + gappx;
 		} else {
+			r = n - i;
+			h = (m->w.height - ty - gappx - gappx * (r - 1)) / r;
 			resize(c, (struct wlr_box){.x = m->w.x + mw, .y = m->w.y + ty,
-				.width = m->w.width - mw, .height = (m->w.height - ty) / (n - i)}, 0);
-			ty += c->geom.height;
+				.width = m->w.width - mw - gappx, .height = h}, 0);
+			ty += c->geom.height + gappx;
 		}
 		i++;
 	}
--
2.45.2

